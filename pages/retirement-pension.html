<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M92225DERV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-M92225DERV');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="í‡´ì§ì—°ê¸ˆ DB/DCí˜• ë¹„êµ, ì¼ì‹œê¸ˆ vs ì—°ê¸ˆ ìˆ˜ë ¹ ë¹„êµ, IRP ì„¸ì•¡ê³µì œ ê³„ì‚°ì„ í•œë²ˆì—. 2025ë…„ ê¸°ì¤€ í‡´ì§ì—°ê¸ˆ ê³„ì‚°ê¸°.">
  <title>í‡´ì§ì—°ê¸ˆ ê³„ì‚°ê¸° - ì—°ê¸ˆ í¬í„¸</title>
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/calculator.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
</head>
<body>
  <nav id="main-nav"></nav>

  <div class="container">
    <div class="page-header fade-in">
      <h1 class="page-title">í‡´ì§ì—°ê¸ˆ ê³„ì‚°ê¸°</h1>
      <p class="page-subtitle">DB/DC ë¹„êµ, í‡´ì§ì†Œë“ì„¸, ì¼ì‹œê¸ˆ vs ì—°ê¸ˆìˆ˜ë ¹ì„ ë¶„ì„í•©ë‹ˆë‹¤</p>
    </div>

    <div class="info-box info fade-in">
      <span class="icon">ğŸ’¡</span>
      <div>
        <strong>DBí˜•</strong>: í‡´ì§ê¸ˆ = ìµœì¢… 3ê°œì›” í‰ê· ì„ê¸ˆ Ã— ê·¼ì†ì—°ìˆ˜<br>
        <strong>DCí˜•</strong>: ë§¤ë…„ ì—°ë´‰ì˜ 1/12ì„ ì ë¦½ â†’ ìš´ìš©ìˆ˜ìµ í¬í•¨<br>
        <strong>IRP</strong>: ì—°ê¸ˆì €ì¶•ê³¼ í•©ì‚° ìµœëŒ€ 900ë§Œì›ê¹Œì§€ ì„¸ì•¡ê³µì œ (13.2~16.5%)
      </div>
    </div>

    <!-- íƒ­ -->
    <div class="tabs fade-in">
      <button class="tab-btn active" onclick="RetirePension.switchTab('calc', this)">í‡´ì§ê¸ˆ/ì„¸ê¸ˆ ê³„ì‚°</button>
      <button class="tab-btn" onclick="RetirePension.switchTab('compare', this)">ì¼ì‹œê¸ˆ vs ì—°ê¸ˆ ë¹„êµ</button>
      <button class="tab-btn" onclick="RetirePension.switchTab('irp', this)">IRP ì„¸ì•¡ê³µì œ</button>
    </div>

    <!-- íƒ­1: í‡´ì§ê¸ˆ/ì„¸ê¸ˆ ê³„ì‚° -->
    <div class="tab-content active" id="tab-calc">
      <div class="calc-layout">
        <div class="calc-input-panel">
          <div class="card">
            <h2 class="card-title"><span class="card-icon">ğŸ“</span>í‡´ì§ê¸ˆ ì •ë³´</h2>
            <form id="rpForm">
              <div class="input-section">
                <div class="form-group">
                  <label class="form-label">í‡´ì§ì—°ê¸ˆ ìœ í˜•</label>
                  <div class="option-group">
                    <label class="option-btn active" onclick="RetirePension.setType(this,'DB')">
                      <input type="radio" name="pensionType" value="DB" checked> DBí˜• (í™•ì •ê¸‰ì—¬)
                    </label>
                    <label class="option-btn" onclick="RetirePension.setType(this,'DC')">
                      <input type="radio" name="pensionType" value="DC"> DCí˜• (í™•ì •ê¸°ì—¬)
                    </label>
                  </div>
                </div>

                <div id="db-fields">
                  <div class="form-group">
                    <label class="form-label">ìµœì¢… 3ê°œì›” í‰ê· ì„ê¸ˆ <span class="unit">(ë§Œì›)</span></label>
                    <div class="input-group">
                      <input type="text" class="form-input" name="avgSalary3m" data-type="money" placeholder="500" value="500">
                      <span class="input-suffix">ë§Œì›</span>
                    </div>
                  </div>
                </div>

                <div id="dc-fields" class="hidden">
                  <div class="form-group">
                    <label class="form-label">ì—°ë´‰ <span class="unit">(ë§Œì›)</span></label>
                    <div class="input-group">
                      <input type="text" class="form-input" name="annualSalary" data-type="money" placeholder="6,000" value="6,000">
                      <span class="input-suffix">ë§Œì›</span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">DC ìš´ìš©ìˆ˜ìµë¥  <span class="unit">(%)</span></label>
                    <div class="input-group">
                      <input type="number" class="form-input" name="dcReturn" step="0.1" min="0" max="20" value="3.0">
                      <span class="input-suffix">%</span>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">ê·¼ì†ì—°ìˆ˜</label>
                  <div class="input-group">
                    <input type="number" class="form-input" name="serviceYears" min="1" max="45" value="20">
                    <span class="input-suffix">ë…„</span>
                  </div>
                </div>
              </div>

              <button type="button" class="btn btn-primary btn-block btn-lg" onclick="RetirePension.calcRetirement()">
                ê³„ì‚°í•˜ê¸°
              </button>
            </form>
          </div>
        </div>

        <div class="calc-result-panel">
          <div id="rp-empty" class="card">
            <div class="empty-result">
              <div class="icon">ğŸ’¼</div>
              <div class="text">ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
            </div>
          </div>

          <div id="rp-result" class="hidden">
            <div class="result-banner fade-in">
              <div class="label">ì˜ˆìƒ í‡´ì§ê¸ˆ (ì„¸ì „)</div>
              <div class="amount" id="rp-gross">-</div>
              <div class="sub" id="rp-type-info">-</div>
            </div>

            <div class="result-mini-grid fade-in">
              <div class="result-mini">
                <div class="label">í‡´ì§ì†Œë“ì„¸</div>
                <div class="value red" id="rp-tax">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì§€ë°©ì†Œë“ì„¸</div>
                <div class="value red" id="rp-local-tax">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì„¸í›„ ìˆ˜ë ¹ì•¡</div>
                <div class="value green" id="rp-net">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì‹¤íš¨ì„¸ìœ¨</div>
                <div class="value" id="rp-effective">-</div>
              </div>
            </div>

            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ”</span>í‡´ì§ì†Œë“ì„¸ ê³„ì‚° ê³¼ì • (ì—°ë¶„ì—°ìŠ¹ë²•)</h2>
              <div class="calc-process" id="rp-process"></div>
            </div>

            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“Š</span>ì„¸ê¸ˆ êµ¬ì„±</h2>
              <div class="chart-container">
                <canvas id="rpTaxChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- íƒ­2: ì¼ì‹œê¸ˆ vs ì—°ê¸ˆ ë¹„êµ -->
    <div class="tab-content" id="tab-compare">
      <div class="calc-layout">
        <div class="calc-input-panel">
          <div class="card">
            <h2 class="card-title"><span class="card-icon">ğŸ“</span>ë¹„êµ ì¡°ê±´</h2>
            <form id="rpCompareForm">
              <div class="form-group">
                <label class="form-label">í‡´ì§ê¸ˆ ì´ì•¡ <span class="unit">(ë§Œì›)</span></label>
                <div class="input-group">
                  <input type="text" class="form-input" name="retireAmount" data-type="money" value="10,000">
                  <span class="input-suffix">ë§Œì›</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ê·¼ì†ì—°ìˆ˜</label>
                <div class="input-group">
                  <input type="number" class="form-input" name="svcYears" value="20" min="1" max="45">
                  <span class="input-suffix">ë…„</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ì—°ê¸ˆ ìˆ˜ë ¹ ê¸°ê°„</label>
                <div class="input-group">
                  <input type="number" class="form-input" name="pensionYears" value="10" min="5" max="30">
                  <span class="input-suffix">ë…„</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">IRP ìš´ìš©ìˆ˜ìµë¥  <span class="unit">(%)</span></label>
                <div class="input-group">
                  <input type="number" class="form-input" name="irpReturn" step="0.1" value="3.0" min="0" max="15">
                  <span class="input-suffix">%</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ìˆ˜ë ¹ ì‹œì‘ ë‚˜ì´</label>
                <div class="input-group">
                  <input type="number" class="form-input" name="startAge" value="55" min="55" max="80">
                  <span class="input-suffix">ì„¸</span>
                </div>
              </div>
              <button type="button" class="btn btn-primary btn-block btn-lg" onclick="RetirePension.calcCompare()">ë¹„êµí•˜ê¸°</button>
            </form>
          </div>
        </div>

        <div class="calc-result-panel">
          <div id="cmp-empty" class="card">
            <div class="empty-result">
              <div class="icon">âš–ï¸</div>
              <div class="text">ì¡°ê±´ì„ ì…ë ¥í•˜ê³  ë¹„êµí•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
            </div>
          </div>

          <div id="cmp-result" class="hidden">
            <div class="compare-grid fade-in">
              <div class="compare-card" id="cmp-lump">
                <span class="badge blue">ì¼ì‹œê¸ˆ ìˆ˜ë ¹</span>
                <div class="result-row">
                  <span class="label">í‡´ì§ê¸ˆ (ì„¸ì „)</span>
                  <span class="value" id="cmp-l-gross">-</span>
                </div>
                <div class="result-row">
                  <span class="label">í‡´ì§ì†Œë“ì„¸</span>
                  <span class="value negative" id="cmp-l-tax">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì„¸í›„ ìˆ˜ë ¹ì•¡</span>
                  <span class="value highlight" id="cmp-l-net">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì‹¤íš¨ì„¸ìœ¨</span>
                  <span class="value" id="cmp-l-rate">-</span>
                </div>
              </div>

              <div class="compare-vs">VS</div>

              <div class="compare-card" id="cmp-pension">
                <span class="badge green">ì—°ê¸ˆ ìˆ˜ë ¹</span>
                <div class="result-row">
                  <span class="label">ì›” ìˆ˜ë ¹ì•¡ (ì„¸í›„)</span>
                  <span class="value highlight" id="cmp-p-monthly">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ìˆ˜ë ¹ ê¸°ê°„</span>
                  <span class="value" id="cmp-p-years">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì´ ìˆ˜ë ¹ì•¡</span>
                  <span class="value" id="cmp-p-total">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì´ ì„¸ê¸ˆ</span>
                  <span class="value negative" id="cmp-p-tax">-</span>
                </div>
              </div>
            </div>

            <div class="info-box success fade-in" id="cmp-saving-box">
              <span class="icon">ğŸ’¡</span>
              <div id="cmp-saving-text"></div>
            </div>

            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“Š</span>ì„¸ê¸ˆ ë¹„êµ</h2>
              <div class="chart-container">
                <canvas id="cmpChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- íƒ­3: IRP ì„¸ì•¡ê³µì œ -->
    <div class="tab-content" id="tab-irp">
      <div class="calc-layout">
        <div class="calc-input-panel">
          <div class="card">
            <h2 class="card-title"><span class="card-icon">ğŸ“</span>IRP ì„¸ì•¡ê³µì œ ê³„ì‚°</h2>
            <form id="irpForm">
              <div class="form-group">
                <label class="form-label">ì´ê¸‰ì—¬ (ì—°ë´‰) <span class="unit">(ë§Œì›)</span></label>
                <div class="input-group">
                  <input type="text" class="form-input" name="totalSalary" data-type="money" value="5,000">
                  <span class="input-suffix">ë§Œì›</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ì—°ê¸ˆì €ì¶• ì—°ê°„ ë‚©ì…ì•¡ <span class="unit">(ë§Œì›)</span></label>
                <div class="input-group">
                  <input type="text" class="form-input" name="pensionSaving" data-type="money" value="600">
                  <span class="input-suffix">ë§Œì›</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">IRP ì—°ê°„ ë‚©ì…ì•¡ <span class="unit">(ë§Œì›)</span></label>
                <div class="input-group">
                  <input type="text" class="form-input" name="irpAmount" data-type="money" value="300">
                  <span class="input-suffix">ë§Œì›</span>
                </div>
              </div>
              <button type="button" class="btn btn-primary btn-block btn-lg" onclick="RetirePension.calcIRP()">ê³„ì‚°í•˜ê¸°</button>
            </form>
          </div>
        </div>

        <div class="calc-result-panel">
          <div id="irp-empty" class="card">
            <div class="empty-result">
              <div class="icon">ğŸ’°</div>
              <div class="text">ë‚©ì… ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
            </div>
          </div>

          <div id="irp-result" class="hidden">
            <div class="result-banner fade-in">
              <div class="label">ì˜ˆìƒ ì„¸ì•¡ê³µì œ í™˜ê¸‰ì•¡</div>
              <div class="amount" id="irp-credit">-</div>
              <div class="sub" id="irp-rate-info">-</div>
            </div>

            <div class="result-mini-grid fade-in">
              <div class="result-mini">
                <div class="label">ì—°ê¸ˆì €ì¶• ê³µì œ ëŒ€ìƒ</div>
                <div class="value" id="irp-ps-deductible">-</div>
              </div>
              <div class="result-mini">
                <div class="label">IRP ê³µì œ ëŒ€ìƒ</div>
                <div class="value" id="irp-irp-deductible">-</div>
              </div>
              <div class="result-mini">
                <div class="label">í•©ì‚° ê³µì œ ëŒ€ìƒ</div>
                <div class="value" id="irp-total-deductible">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ê³µì œìœ¨</div>
                <div class="value" id="irp-credit-rate">-</div>
              </div>
            </div>

            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“‹</span>ì„¸ì•¡ê³µì œ í•œë„ ì•ˆë‚´</h2>
              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr><th>êµ¬ë¶„</th><th>í•œë„</th><th>ë¹„ê³ </th></tr>
                  </thead>
                  <tbody>
                    <tr><td>ì—°ê¸ˆì €ì¶•</td><td>600ë§Œì›</td><td>ì„¸ì•¡ê³µì œ ëŒ€ìƒ í•œë„</td></tr>
                    <tr><td>IRP (ì¶”ê°€)</td><td>300ë§Œì›</td><td>ì—°ê¸ˆì €ì¶• + IRP í•©ì‚° 900ë§Œì›</td></tr>
                    <tr><td>ë‚©ì…í•œë„</td><td>1,800ë§Œì›/ë…„</td><td>ì—°ê¸ˆì €ì¶•+IRP ì´ ë‚©ì…í•œë„</td></tr>
                    <tr>
                      <td>ê³µì œìœ¨</td>
                      <td id="irp-table-rate">-</td>
                      <td id="irp-table-note">-</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="info-box info fade-in">
              <span class="icon">ğŸ“Œ</span>
              <div>
                <strong>ISA â†’ ì—°ê¸ˆì „í™˜ ì‹œ ì¶”ê°€ í˜œíƒ:</strong> ISA ë§Œê¸° ìê¸ˆì„ 60ì¼ ì´ë‚´ ì—°ê¸ˆê³„ì¢Œë¡œ ì „í™˜í•˜ë©´ ì „í™˜ê¸ˆì•¡ì˜ 10%(ìµœëŒ€ 300ë§Œì›) ì¶”ê°€ ì„¸ì•¡ê³µì œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer id="footer"></footer>

  <script src="../js/constants.js"></script>
  <script src="../js/calculator-engine.js"></script>
  <script src="../js/common.js"></script>
  <script>
    const RetirePension = {
      switchTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        btn.classList.add('active');
        APP.input.initMoneyFields();
      },

      setType(el, type) {
        document.querySelectorAll('#rpForm .option-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('db-fields').classList.toggle('hidden', type !== 'DB');
        document.getElementById('dc-fields').classList.toggle('hidden', type !== 'DC');
        APP.input.initMoneyFields();
      },

      calcRetirement() {
        const calcBtn = document.querySelector('#rpForm .btn-primary');
        APP.button.loading(calcBtn);
        const form = document.getElementById('rpForm');
        const type = form.querySelector('input[name="pensionType"]:checked').value;
        const serviceYears = Number(form.serviceYears.value) || 20;

        let retirementIncome;
        if (type === 'DB') {
          const avgSalary3m = Number(form.avgSalary3m.value.replace(/[^0-9]/g, '')) * 10000;
          retirementIncome = CalcEngine.retirementPension.calcDB(avgSalary3m, serviceYears);
        } else {
          const annualSalary = Number(form.annualSalary.value.replace(/[^0-9]/g, '')) * 10000;
          const dcReturn = Number(form.dcReturn.value) / 100;
          const annualContribution = annualSalary / 12;
          retirementIncome = CalcEngine.retirementPension.calcDC(annualContribution, serviceYears, dcReturn);
        }

        const taxResult = CalcEngine.retirementPension.calcRetirementIncomeTax(retirementIncome, serviceYears);
        const netAmount = retirementIncome - taxResult.totalTax;

        document.getElementById('rp-empty').classList.add('hidden');
        document.getElementById('rp-result').classList.remove('hidden');

        document.getElementById('rp-gross').textContent = APP.format.manwon(retirementIncome);
        document.getElementById('rp-type-info').textContent = `${type}í˜•, ê·¼ì† ${serviceYears}ë…„`;
        document.getElementById('rp-tax').textContent = APP.format.manwon(taxResult.incomeTax);
        document.getElementById('rp-local-tax').textContent = APP.format.manwon(taxResult.localTax);
        document.getElementById('rp-net').textContent = APP.format.manwon(netAmount);
        document.getElementById('rp-effective').textContent = APP.format.percent(taxResult.effectiveRate);

        // ê³„ì‚° ê³¼ì •
        document.getElementById('rp-process').innerHTML = `
          <div class="calc-process-title">ì—°ë¶„ì—°ìŠ¹ë²• ê³„ì‚° ê³¼ì •</div>
          <div class="calc-process-step">
            <span class="step-num">1</span>
            <span>í‡´ì§ê¸‰ì—¬ (ì„¸ì „)</span>
            <span class="step-formula">${APP.format.manwon(retirementIncome)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">2</span>
            <span>ê·¼ì†ì—°ìˆ˜ ê³µì œ (${serviceYears}ë…„)</span>
            <span class="step-formula">-${APP.format.manwon(taxResult.serviceDeduction)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">3</span>
            <span>í™˜ì‚°ê¸‰ì—¬ = (í‡´ì§ê¸‰ì—¬ - ê·¼ì†ê³µì œ) Ã— 12 Ã· ${serviceYears}</span>
            <span class="step-formula">${APP.format.manwon(taxResult.convertedIncome)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">4</span>
            <span>í™˜ì‚°ê¸‰ì—¬ ê³µì œ</span>
            <span class="step-formula">-${APP.format.manwon(taxResult.convertedDeduction)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">5</span>
            <span>ê³¼ì„¸í‘œì¤€ (í™˜ì‚°ê¸‰ì—¬ - í™˜ì‚°ê¸‰ì—¬ê³µì œ)</span>
            <span class="step-formula">${APP.format.manwon(taxResult.taxableConverted)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">6</span>
            <span>í™˜ì‚°ì‚°ì¶œì„¸ì•¡</span>
            <span class="step-formula">${APP.format.manwon(taxResult.convertedTax)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">7</span>
            <span>ìµœì¢… ì‚°ì¶œì„¸ì•¡ = í™˜ì‚°ì„¸ì•¡ Ã— ${serviceYears} Ã· 12</span>
            <span class="step-formula">${APP.format.manwon(taxResult.incomeTax)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">8</span>
            <span>ì§€ë°©ì†Œë“ì„¸ (ì†Œë“ì„¸ì˜ 10%)</span>
            <span class="step-formula">${APP.format.manwon(taxResult.localTax)}</span>
          </div>
        `;

        // ì°¨íŠ¸
        APP.chart.create('rpTaxChart', {
          type: 'doughnut',
          data: {
            labels: ['ì„¸í›„ ìˆ˜ë ¹ì•¡', 'í‡´ì§ì†Œë“ì„¸', 'ì§€ë°©ì†Œë“ì„¸'],
            datasets: [{
              data: [netAmount, taxResult.incomeTax, taxResult.localTax],
              backgroundColor: [APP.chart.colors.secondary, APP.chart.colors.danger, APP.chart.colors.accent],
              borderWidth: 2,
            }]
          },
          options: {
            plugins: {
              title: { display: true, text: 'í‡´ì§ê¸ˆ ì„¸ê¸ˆ êµ¬ì„±', font: { size: 16 } }
            }
          }
        });

        APP.storage.saveForm('rpForm');
        requestAnimationFrame(() => APP.button.reset(calcBtn));
      },

      calcCompare() {
        const calcBtn = document.querySelector('#rpCompareForm .btn-primary');
        APP.button.loading(calcBtn);
        const form = document.getElementById('rpCompareForm');
        const retireAmount = Number(form.retireAmount.value.replace(/[^0-9]/g, '')) * 10000;
        const svcYears = Number(form.svcYears.value) || 20;
        const pensionYears = Number(form.pensionYears.value) || 10;
        const irpReturn = Number(form.irpReturn.value) / 100 || 0.03;
        const startAge = Number(form.startAge.value) || 55;

        const result = CalcEngine.retirementPension.compareLumpSumVsPension(
          retireAmount, svcYears, pensionYears, irpReturn, startAge
        );

        document.getElementById('cmp-empty').classList.add('hidden');
        document.getElementById('cmp-result').classList.remove('hidden');

        // ì¼ì‹œê¸ˆ
        document.getElementById('cmp-l-gross').textContent = APP.format.manwon(result.lumpSum.gross);
        document.getElementById('cmp-l-tax').textContent = '-' + APP.format.manwon(result.lumpSum.tax);
        document.getElementById('cmp-l-net').textContent = APP.format.manwon(result.lumpSum.net);
        document.getElementById('cmp-l-rate').textContent = APP.format.percent(result.lumpSum.effectiveRate);

        // ì—°ê¸ˆ
        document.getElementById('cmp-p-monthly').textContent = APP.format.manwon(result.pension.monthlyNet);
        document.getElementById('cmp-p-years').textContent = pensionYears + 'ë…„';
        document.getElementById('cmp-p-total').textContent = APP.format.manwon(result.pension.totalReceived);
        document.getElementById('cmp-p-tax').textContent = '-' + APP.format.manwon(result.pension.totalTax);

        // ì¶”ì²œ
        const lumpCard = document.getElementById('cmp-lump');
        const penCard = document.getElementById('cmp-pension');
        if (result.taxSaving > 0) {
          penCard.classList.add('recommended');
          lumpCard.classList.remove('recommended');
          document.getElementById('cmp-saving-text').innerHTML =
            `<strong>ì—°ê¸ˆìˆ˜ë ¹ì´ ìœ ë¦¬í•©ë‹ˆë‹¤!</strong> ì„¸ê¸ˆ ì ˆì•½ì•¡: <strong>${APP.format.manwon(result.taxSaving)}</strong><br>
             ì—°ê¸ˆìˆ˜ë ¹ ì‹œ í‡´ì§ì†Œë“ì„¸ê°€ 30~40% ê°ë©´ë˜ê³ , IRP ìš´ìš©ìˆ˜ìµë„ ì¶”ê°€ë©ë‹ˆë‹¤.`;
        } else {
          lumpCard.classList.add('recommended');
          penCard.classList.remove('recommended');
          document.getElementById('cmp-saving-text').innerHTML =
            `<strong>ì¼ì‹œê¸ˆ ìˆ˜ë ¹ì´ ìœ ë¦¬í•©ë‹ˆë‹¤.</strong> í•˜ì§€ë§Œ IRP ìš´ìš© ê¸°ê°„ê³¼ ìˆ˜ìµë¥ ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
        }

        // ì°¨íŠ¸
        APP.chart.create('cmpChart', {
          type: 'bar',
          data: {
            labels: ['ì¼ì‹œê¸ˆ ìˆ˜ë ¹', 'ì—°ê¸ˆ ìˆ˜ë ¹'],
            datasets: [
              {
                label: 'ì„¸í›„ ìˆ˜ë ¹ì•¡',
                data: [result.lumpSum.net, result.pension.totalReceived],
                backgroundColor: [APP.chart.colors.primaryAlpha, APP.chart.colors.secondaryAlpha],
                borderColor: [APP.chart.colors.primary, APP.chart.colors.secondary],
                borderWidth: 2,
              },
              {
                label: 'ì„¸ê¸ˆ',
                data: [result.lumpSum.tax, result.pension.totalTax],
                backgroundColor: [APP.chart.colors.dangerAlpha, APP.chart.colors.dangerAlpha],
                borderColor: [APP.chart.colors.danger, APP.chart.colors.danger],
                borderWidth: 2,
              }
            ]
          },
          options: {
            plugins: {
              title: { display: true, text: 'ì¼ì‹œê¸ˆ vs ì—°ê¸ˆ ìˆ˜ë ¹ ë¹„êµ', font: { size: 16 } }
            },
            scales: {
              y: { title: { display: true, text: 'ì›' }, ticks: { callback: v => APP.format.manwon(v) } }
            }
          }
        });
        requestAnimationFrame(() => APP.button.reset(calcBtn));
      },

      calcIRP() {
        const calcBtn = document.querySelector('#irpForm .btn-primary');
        APP.button.loading(calcBtn);
        const form = document.getElementById('irpForm');
        const totalSalary = Number(form.totalSalary.value.replace(/[^0-9]/g, '')) * 10000;
        const pensionSaving = Number(form.pensionSaving.value.replace(/[^0-9]/g, '')) * 10000;
        const irpAmount = Number(form.irpAmount.value.replace(/[^0-9]/g, '')) * 10000;

        const result = CalcEngine.retirementPension.calcIRPTaxCredit(pensionSaving, irpAmount, totalSalary);

        document.getElementById('irp-empty').classList.add('hidden');
        document.getElementById('irp-result').classList.remove('hidden');

        document.getElementById('irp-credit').textContent = APP.format.manwon(result.creditAmount);
        document.getElementById('irp-rate-info').textContent =
          `ì´ê¸‰ì—¬ ${APP.format.manwon(totalSalary)} ê¸°ì¤€, ê³µì œìœ¨ ${APP.format.percent(result.rate)}`;

        const effectivePS = Math.min(pensionSaving, 6000000);
        const effectiveIRP = Math.min(result.totalDeductible - effectivePS, irpAmount);
        document.getElementById('irp-ps-deductible').textContent = APP.format.manwon(effectivePS);
        document.getElementById('irp-irp-deductible').textContent = APP.format.manwon(effectiveIRP);
        document.getElementById('irp-total-deductible').textContent = APP.format.manwon(result.totalDeductible);
        document.getElementById('irp-credit-rate').textContent = APP.format.percent(result.rate);

        document.getElementById('irp-table-rate').textContent = APP.format.percent(result.rate);
        document.getElementById('irp-table-note').textContent =
          totalSalary <= 55000000 ? 'ì´ê¸‰ì—¬ 5,500ë§Œì› ì´í•˜' : 'ì´ê¸‰ì—¬ 5,500ë§Œì› ì´ˆê³¼';
        requestAnimationFrame(() => APP.button.reset(calcBtn));
      },
    };

    document.addEventListener('DOMContentLoaded', () => {
      APP.storage.restoreForm('rpForm');
      APP.storage.restoreForm('rpCompareForm');
      APP.storage.restoreForm('irpForm');
    });
  </script>
</body>
</html>
