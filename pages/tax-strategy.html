<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì ˆì„¸ ì „ëµ - ì—°ê¸ˆ í¬í„¸</title>
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/calculator.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
</head>
<body>
  <nav id="main-nav"></nav>

  <div class="container">
    <div class="page-header fade-in">
      <h1 class="page-title">ì ˆì„¸ ì „ëµ ì‹œë®¬ë ˆì´í„°</h1>
      <p class="page-subtitle">ì¢…í•©ì†Œë“ì„¸, ì—°ê¸ˆì†Œë“ì„¸, í‡´ì§ì†Œë“ì„¸ë¥¼ ê³„ì‚°í•˜ê³  ìµœì  ì ˆì„¸ ì „ëµì„ ì°¾ìœ¼ì„¸ìš”</p>
    </div>

    <div class="info-box info fade-in">
      <span class="icon">ğŸ’¡</span>
      <div>
        <strong>í•µì‹¬ ì ˆì„¸ í¬ì¸íŠ¸</strong><br>
        â€¢ ì‚¬ì ì—°ê¸ˆ ì—° 1,500ë§Œì› ì´í•˜ â†’ ì €ìœ¨ ë¶„ë¦¬ê³¼ì„¸(3.3~5.5%)<br>
        â€¢ í‡´ì§ê¸ˆì€ IRP ì´ì „ í›„ ì—°ê¸ˆìˆ˜ë ¹ ì‹œ ì„¸ê¸ˆ 30~40% ê°ë©´<br>
        â€¢ ì—°ê¸ˆì €ì¶•+IRP ì„¸ì•¡ê³µì œ ìµœëŒ€ 900ë§Œì› â†’ í™˜ê¸‰ ìµœëŒ€ 148.5ë§Œì›
      </div>
    </div>

    <!-- íƒ­ -->
    <div class="tabs fade-in">
      <button class="tab-btn active" onclick="TaxStrategy.switchTab('income', this)">ì¢…í•©ì†Œë“ì„¸</button>
      <button class="tab-btn" onclick="TaxStrategy.switchTab('pension', this)">ì—°ê¸ˆì†Œë“ ì ˆì„¸</button>
      <button class="tab-btn" onclick="TaxStrategy.switchTab('retire', this)">í‡´ì§ì†Œë“ì„¸</button>
    </div>

    <!-- ==============================
         íƒ­1: ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸°
         ============================== -->
    <div class="tab-content active" id="tab-income">
      <div class="calc-layout">
        <div class="calc-input-panel">
          <div class="card">
            <h2 class="card-title"><span class="card-icon">ğŸ“</span>ì†Œë“ ì •ë³´ ì…ë ¥</h2>
            <form id="taxIncomeForm">
              <div class="input-section">
                <div class="input-section-title">ì†Œë“ í•­ëª© (ì—°ê°„)</div>
                <div class="form-group">
                  <label class="form-label">ê·¼ë¡œì†Œë“ <span class="unit">(ë§Œì›)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="salary" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ì‚¬ì—…ì†Œë“ <span class="unit">(ë§Œì›)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="business" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ê³µì ì—°ê¸ˆì†Œë“ <span class="unit">(ë§Œì›/ë…„)</span>
                    <span class="tooltip-trigger" data-tooltip="êµ­ë¯¼ì—°ê¸ˆ ë“± ê³µì ì—°ê¸ˆ. 2002ë…„ ì´í›„ ë‚©ì…ë¶„ì— ëŒ€í•´ ê³¼ì„¸ë©ë‹ˆë‹¤.">?</span>
                  </label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="publicPension" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ì´ìÂ·ë°°ë‹¹ì†Œë“ <span class="unit">(ë§Œì›)</span>
                    <span class="tooltip-trigger" data-tooltip="2,000ë§Œì› ì´ˆê³¼ ì‹œ ì¢…í•©ê³¼ì„¸ ëŒ€ìƒ. ì´í•˜ëŠ” 15.4% ì›ì²œì§•ìˆ˜ë¡œ ë¶„ë¦¬ê³¼ì„¸.">?</span>
                  </label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="financial" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ì„ëŒ€ì†Œë“ <span class="unit">(ë§Œì›)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="rental" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ê¸°íƒ€ì†Œë“ <span class="unit">(ë§Œì›)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="other" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
              </div>

              <div class="input-section">
                <div class="input-section-title">ê³µì œ í•­ëª©</div>
                <div class="form-group">
                  <label class="form-label">ì¸ì ê³µì œ ì¸ì› <span class="unit">(ë³¸ì¸ í¬í•¨)</span></label>
                  <div class="input-group">
                    <input type="number" class="form-input" name="dependents" value="1" min="1" max="10">
                    <span class="input-suffix">ëª…</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">êµ­ë¯¼ì—°ê¸ˆ ë‚©ë¶€ì•¡ <span class="unit">(ë§Œì›/ë…„)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="npPaid" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ì—°ê¸ˆì €ì¶•+IRP ì„¸ì•¡ê³µì œ ëŒ€ìƒ <span class="unit">(ë§Œì›)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="pensionCredit" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
              </div>

              <button type="button" class="btn btn-primary btn-block btn-lg" onclick="TaxStrategy.calcIncomeTax()">ê³„ì‚°í•˜ê¸°</button>
            </form>
          </div>
        </div>

        <div class="calc-result-panel">
          <div id="it-empty" class="card">
            <div class="empty-result">
              <div class="icon">ğŸ“‹</div>
              <div class="text">ì†Œë“ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
              <div class="sub-text">ì¢…í•©ì†Œë“ì„¸ì™€ ì‹¤íš¨ì„¸ìœ¨ì„ ê³„ì‚°í•©ë‹ˆë‹¤</div>
            </div>
          </div>

          <div id="it-result" style="display:none;">
            <div class="result-banner fade-in">
              <div class="label">ì¢…í•©ì†Œë“ì„¸ + ì§€ë°©ì†Œë“ì„¸</div>
              <div class="amount" id="it-total-tax">-</div>
              <div class="sub" id="it-effective">-</div>
            </div>

            <div class="result-mini-grid fade-in">
              <div class="result-mini">
                <div class="label">ì´ ì†Œë“</div>
                <div class="value" id="it-gross">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ê³¼ì„¸í‘œì¤€</div>
                <div class="value" id="it-taxable">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì ìš© ì„¸ìœ¨</div>
                <div class="value" id="it-rate">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì„¸ì•¡ê³µì œ í•©ê³„</div>
                <div class="value green" id="it-credits">-</div>
              </div>
            </div>

            <!-- ê³„ì‚° ê³¼ì • -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ”</span>ê³„ì‚° ê³¼ì •</h2>
              <div class="calc-process" id="it-process"></div>
            </div>

            <!-- ì„¸ìœ¨ êµ¬ê°„ ì°¨íŠ¸ -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“Š</span>ì†Œë“ì„¸ ëˆ„ì§„ì„¸ìœ¨ êµ¬ê°„</h2>
              <div class="chart-container tall">
                <canvas id="itBracketChart"></canvas>
              </div>
            </div>

            <!-- ì„¸ìœ¨í‘œ -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“‹</span>ì¢…í•©ì†Œë“ì„¸ ëˆ„ì§„ì„¸ìœ¨í‘œ</h2>
              <div class="table-responsive">
                <table class="data-table" id="it-bracket-table">
                  <thead>
                    <tr><th>ê³¼ì„¸í‘œì¤€ êµ¬ê°„</th><th>ì„¸ìœ¨</th><th>ëˆ„ì§„ê³µì œ</th><th>ë¹„ê³ </th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ==============================
         íƒ­2: ì—°ê¸ˆì†Œë“ ì ˆì„¸
         ============================== -->
    <div class="tab-content" id="tab-pension">
      <div class="calc-layout">
        <div class="calc-input-panel">
          <div class="card">
            <h2 class="card-title"><span class="card-icon">ğŸ“</span>ì—°ê¸ˆì†Œë“ ì •ë³´</h2>
            <form id="taxPensionForm">
              <div class="input-section">
                <div class="input-section-title">ì—°ê¸ˆ ìˆ˜ë ¹ ì •ë³´</div>
                <div class="form-group">
                  <label class="form-label">ë‚˜ì´</label>
                  <div class="input-group">
                    <input type="number" class="form-input" name="age" value="65" min="55" max="100">
                    <span class="input-suffix">ì„¸</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ì‚¬ì ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ <span class="unit">(ë§Œì›/ë…„)</span>
                    <span class="tooltip-trigger" data-tooltip="ì—°ê¸ˆì €ì¶•, IRPì—ì„œ ìˆ˜ë ¹í•˜ëŠ” ì—°ê¸ˆ. 1,500ë§Œì›ì´ ë¶„ë¦¬ê³¼ì„¸ ê¸°ì¤€ì„ ì…ë‹ˆë‹¤.">?</span>
                  </label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="privatePension" data-type="money" value="1,200">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ê³µì ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ <span class="unit">(ë§Œì›/ë…„)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="publicPension" data-type="money" value="1,200">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
              </div>
              <div class="input-section">
                <div class="input-section-title">ê¸°íƒ€ ì†Œë“</div>
                <div class="form-group">
                  <label class="form-label">ì´ìÂ·ë°°ë‹¹ì†Œë“ <span class="unit">(ë§Œì›/ë…„)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="finIncome" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">ì„ëŒ€Â·ê¸°íƒ€ì†Œë“ <span class="unit">(ë§Œì›/ë…„)</span></label>
                  <div class="input-group">
                    <input type="text" class="form-input" name="etcIncome" data-type="money" value="0">
                    <span class="input-suffix">ë§Œì›</span>
                  </div>
                </div>
              </div>
              <button type="button" class="btn btn-primary btn-block btn-lg" onclick="TaxStrategy.calcPensionTax()">ë¶„ì„í•˜ê¸°</button>
            </form>
          </div>
        </div>

        <div class="calc-result-panel">
          <div id="pt-empty" class="card">
            <div class="empty-result">
              <div class="icon">ğŸ’°</div>
              <div class="text">ì—°ê¸ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ë¶„ì„í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
              <div class="sub-text">ë¶„ë¦¬ê³¼ì„¸ vs ì¢…í•©ê³¼ì„¸ ìµœì  ì „ëµì„ ë¶„ì„í•©ë‹ˆë‹¤</div>
            </div>
          </div>

          <div id="pt-result" style="display:none;">
            <!-- ë¶„ë¦¬ê³¼ì„¸ vs ì¢…í•©ê³¼ì„¸ ë¹„êµ -->
            <div class="compare-grid fade-in">
              <div class="compare-card" id="pt-sep-card">
                <span class="badge blue">ë¶„ë¦¬ê³¼ì„¸</span>
                <div class="result-row">
                  <span class="label">ì ìš© ì„¸ìœ¨</span>
                  <span class="value" id="pt-sep-rate">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì‚¬ì ì—°ê¸ˆ ì„¸ê¸ˆ</span>
                  <span class="value negative" id="pt-sep-tax">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ê¸°íƒ€ì†Œë“ ì„¸ê¸ˆ</span>
                  <span class="value negative" id="pt-sep-other-tax">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì´ ì„¸ê¸ˆ</span>
                  <span class="value highlight" id="pt-sep-total">-</span>
                </div>
              </div>

              <div class="compare-vs">VS</div>

              <div class="compare-card" id="pt-comp-card">
                <span class="badge orange">ì¢…í•©ê³¼ì„¸</span>
                <div class="result-row">
                  <span class="label">í•©ì‚° ì†Œë“</span>
                  <span class="value" id="pt-comp-income">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì—°ê¸ˆì†Œë“ê³µì œ</span>
                  <span class="value positive" id="pt-comp-deduction">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì¢…í•©ì†Œë“ì„¸</span>
                  <span class="value negative" id="pt-comp-tax">-</span>
                </div>
                <div class="result-row">
                  <span class="label">ì´ ì„¸ê¸ˆ</span>
                  <span class="value highlight" id="pt-comp-total">-</span>
                </div>
              </div>
            </div>

            <div class="info-box success fade-in">
              <span class="icon">âœ…</span>
              <div id="pt-recommend-text"></div>
            </div>

            <!-- ìµœì  ìˆ˜ë ¹ì•¡ ë¶„ì„ -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“Š</span>ì‚¬ì ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ë³„ ì„¸ê¸ˆ ë³€í™”</h2>
              <div class="chart-container tall">
                <canvas id="ptOptimalChart"></canvas>
              </div>
              <div class="info-box warning" style="margin-top:12px;">
                <span class="icon">âš ï¸</span>
                <div>
                  <strong>ì‚¬ì ì—°ê¸ˆ 1,500ë§Œì› ê¸°ì¤€ì„ :</strong>
                  1,500ë§Œì› ì´í•˜ëŠ” ì €ìœ¨ ë¶„ë¦¬ê³¼ì„¸(3.3~5.5%)ê°€ ì ìš©ë©ë‹ˆë‹¤.
                  ì´ˆê³¼ ì‹œ ì „ì•¡ì— ëŒ€í•´ 15% ë¶„ë¦¬ê³¼ì„¸ ë˜ëŠ” ì¢…í•©ê³¼ì„¸ ì¤‘ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.
                </div>
              </div>
            </div>

            <!-- ì—°ê¸ˆì†Œë“ì„¸ìœ¨ ì°¸ê³  -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“‹</span>ì—°ê¸ˆì†Œë“ì„¸ìœ¨ (ë‚˜ì´ë³„)</h2>
              <div class="table-responsive">
                <table class="data-table">
                  <thead>
                    <tr><th>ë‚˜ì´</th><th>ì—°ê¸ˆì†Œë“ì„¸ìœ¨</th><th>ë¹„ê³ </th></tr>
                  </thead>
                  <tbody>
                    <tr><td>55~69ì„¸</td><td>5.5% (ì§€ë°©ì„¸ í¬í•¨)</td><td>ê°€ì¥ ë†’ì€ êµ¬ê°„</td></tr>
                    <tr><td>70~79ì„¸</td><td>4.4% (ì§€ë°©ì„¸ í¬í•¨)</td><td>ì¤‘ê°„ êµ¬ê°„</td></tr>
                    <tr><td>80ì„¸ ì´ìƒ</td><td>3.3% (ì§€ë°©ì„¸ í¬í•¨)</td><td>ê°€ì¥ ë‚®ì€ êµ¬ê°„</td></tr>
                    <tr class="total-row"><td>1,500ë§Œì› ì´ˆê³¼</td><td>15% (ë¶„ë¦¬ê³¼ì„¸ ì„ íƒ ì‹œ)</td><td>ë˜ëŠ” ì¢…í•©ê³¼ì„¸</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ==============================
         íƒ­3: í‡´ì§ì†Œë“ì„¸
         ============================== -->
    <div class="tab-content" id="tab-retire">
      <div class="calc-layout">
        <div class="calc-input-panel">
          <div class="card">
            <h2 class="card-title"><span class="card-icon">ğŸ“</span>í‡´ì§ì†Œë“ ì •ë³´</h2>
            <form id="taxRetireForm">
              <div class="form-group">
                <label class="form-label">í‡´ì§ê¸ˆ (ì„¸ì „) <span class="unit">(ë§Œì›)</span></label>
                <div class="input-group">
                  <input type="text" class="form-input" name="retireIncome" data-type="money" value="10,000">
                  <span class="input-suffix">ë§Œì›</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ê·¼ì†ì—°ìˆ˜</label>
                <div class="input-group">
                  <input type="number" class="form-input" name="serviceYears" value="20" min="1" max="45">
                  <span class="input-suffix">ë…„</span>
                </div>
              </div>
              <button type="button" class="btn btn-primary btn-block btn-lg" onclick="TaxStrategy.calcRetireTax()">ê³„ì‚°í•˜ê¸°</button>
            </form>

            <!-- ê·¼ì†ì—°ìˆ˜ë³„ ë¹„êµ ë„êµ¬ -->
            <div style="margin-top:20px; padding-top:20px; border-top:1px dashed var(--border);">
              <div class="input-section-title">ê·¼ì†ì—°ìˆ˜ë³„ ì„¸ê¸ˆ ë¹„êµ</div>
              <p style="color:var(--text-light); font-size:var(--font-sm); margin-bottom:12px;">ë™ì¼ í‡´ì§ê¸ˆì— ëŒ€í•´ ê·¼ì†ì—°ìˆ˜ê°€ ì„¸ê¸ˆì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¹„êµí•©ë‹ˆë‹¤</p>
              <button type="button" class="btn btn-outline btn-block" onclick="TaxStrategy.calcRetireCompare()">ë¹„êµ ì°¨íŠ¸ ë³´ê¸°</button>
            </div>
          </div>
        </div>

        <div class="calc-result-panel">
          <div id="rt-empty" class="card">
            <div class="empty-result">
              <div class="icon">ğŸ“‹</div>
              <div class="text">í‡´ì§ê¸ˆ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
            </div>
          </div>

          <div id="rt-result" style="display:none;">
            <div class="result-banner fade-in">
              <div class="label">í‡´ì§ì†Œë“ì„¸ + ì§€ë°©ì†Œë“ì„¸</div>
              <div class="amount" id="rt-total-tax">-</div>
              <div class="sub" id="rt-effective">-</div>
            </div>

            <div class="result-mini-grid fade-in">
              <div class="result-mini">
                <div class="label">í‡´ì§ê¸ˆ (ì„¸ì „)</div>
                <div class="value" id="rt-gross">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì„¸í›„ ìˆ˜ë ¹ì•¡</div>
                <div class="value green" id="rt-net">-</div>
              </div>
              <div class="result-mini">
                <div class="label">í‡´ì§ì†Œë“ì„¸</div>
                <div class="value red" id="rt-income-tax">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì§€ë°©ì†Œë“ì„¸</div>
                <div class="value red" id="rt-local-tax">-</div>
              </div>
            </div>

            <!-- ì—°ë¶„ì—°ìŠ¹ë²• ê³¼ì • -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ”</span>ì—°ë¶„ì—°ìŠ¹ë²• ê³„ì‚° ê³¼ì •</h2>
              <div class="calc-process" id="rt-process"></div>
            </div>

            <!-- ì„¸ê¸ˆ êµ¬ì„± ì°¨íŠ¸ -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“Š</span>í‡´ì§ê¸ˆ êµ¬ì„±</h2>
              <div class="chart-container">
                <canvas id="rtPieChart"></canvas>
              </div>
            </div>

            <!-- ì—°ê¸ˆìˆ˜ë ¹ ì „í™˜ ì•ˆë‚´ -->
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ’¡</span>ì—°ê¸ˆìˆ˜ë ¹ ì „í™˜ ì‹œ ì ˆì„¸ íš¨ê³¼</h2>
              <div class="result-mini-grid">
                <div class="result-mini">
                  <div class="label">ì¼ì‹œê¸ˆ ì„¸ê¸ˆ</div>
                  <div class="value red" id="rt-lump-tax">-</div>
                </div>
                <div class="result-mini">
                  <div class="label">ì—°ê¸ˆì „í™˜ ì‹œ ì„¸ê¸ˆ (10ë…„)</div>
                  <div class="value green" id="rt-pension-tax">-</div>
                </div>
                <div class="result-mini">
                  <div class="label">ì ˆì„¸ íš¨ê³¼</div>
                  <div class="value green" id="rt-saving">-</div>
                </div>
              </div>
              <div class="info-box info" style="margin-top:12px;">
                <span class="icon">ğŸ“Œ</span>
                <div>í‡´ì§ê¸ˆì„ IRPë¡œ ì´ì „í•˜ì—¬ ì—°ê¸ˆìœ¼ë¡œ ìˆ˜ë ¹í•˜ë©´ í‡´ì§ì†Œë“ì„¸ì˜ <strong>30~40%ê°€ ê°ë©´</strong>ë©ë‹ˆë‹¤. ìì„¸í•œ ë¹„êµëŠ” <a href="retirement-pension.html" style="color:var(--primary); font-weight:700;">í‡´ì§ì—°ê¸ˆ ê³„ì‚°ê¸°</a>ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</div>
              </div>
            </div>
          </div>

          <!-- ê·¼ì†ì—°ìˆ˜ ë¹„êµ ì°¨íŠ¸ (ë³„ë„) -->
          <div id="rt-compare" style="display:none;">
            <div class="card fade-in">
              <h2 class="card-title"><span class="card-icon">ğŸ“Š</span>ê·¼ì†ì—°ìˆ˜ë³„ í‡´ì§ì†Œë“ì„¸ ë¹„êµ</h2>
              <div class="chart-container tall">
                <canvas id="rtCompareChart"></canvas>
              </div>
              <div class="info-box info" style="margin-top:12px;">
                <span class="icon">ğŸ’¡</span>
                <div id="rt-compare-text"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer id="footer"></footer>

  <script src="../js/constants.js"></script>
  <script src="../js/calculator-engine.js"></script>
  <script src="../js/common.js"></script>
  <script>
    const TaxStrategy = {
      switchTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        btn.classList.add('active');
        APP.input.initMoneyFields();
      },

      // ==========================================
      // íƒ­1: ì¢…í•©ì†Œë“ì„¸
      // ==========================================
      calcIncomeTax() {
        const form = document.getElementById('taxIncomeForm');
        const getVal = (name) => Number(form[name].value.replace(/[^0-9]/g, '')) * 10000;

        const salary = getVal('salary');
        const business = getVal('business');
        const publicPension = getVal('publicPension');
        const financial = getVal('financial');
        const rental = getVal('rental');
        const other = getVal('other');
        const dependents = Number(form.dependents.value) || 1;
        const npPaid = getVal('npPaid');
        const pensionCreditInput = getVal('pensionCredit');

        const grossIncome = salary + business + publicPension + financial + rental + other;
        if (grossIncome <= 0) {
          alert('ì†Œë“ í•­ëª©ì„ í•˜ë‚˜ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        // ì†Œë“ê³µì œ ê³„ì‚° (ê°„ì†Œí™”)
        // ê·¼ë¡œì†Œë“ê³µì œ (ê·¼ë¡œì†Œë“ì´ ìˆì„ ë•Œ)
        let earnedDeduction = 0;
        if (salary > 0) {
          if (salary <= 5000000) earnedDeduction = salary * 0.7;
          else if (salary <= 15000000) earnedDeduction = 3500000 + (salary - 5000000) * 0.4;
          else if (salary <= 45000000) earnedDeduction = 7500000 + (salary - 15000000) * 0.15;
          else if (salary <= 100000000) earnedDeduction = 12000000 + (salary - 45000000) * 0.05;
          else earnedDeduction = 14750000 + (salary - 100000000) * 0.02;
        }

        // ì—°ê¸ˆì†Œë“ê³µì œ
        const pensionDeduction = publicPension > 0
          ? CalcEngine.tax.calcPensionDeduction(publicPension)
          : 0;

        // ì¸ì ê³µì œ
        const personalDeduction = dependents * CONSTANTS.TAX.BASIC_DEDUCTION;

        // êµ­ë¯¼ì—°ê¸ˆ ë³´í—˜ë£Œ ê³µì œ (ì†Œë“ê³µì œ)
        const npDeduction = npPaid;

        const totalDeductions = earnedDeduction + pensionDeduction + personalDeduction + npDeduction;
        const taxableIncome = Math.max(grossIncome - totalDeductions, 0);

        // ì‚°ì¶œì„¸ì•¡
        const taxResult = CalcEngine.tax.calcIncomeTax(taxableIncome);

        // ì„¸ì•¡ê³µì œ (ì—°ê¸ˆì €ì¶•+IRP)
        const pensionCreditBase = Math.min(pensionCreditInput, 9000000);
        const creditRate = salary > 55000000 ? 0.132 : 0.165;
        const pensionTaxCredit = Math.round(pensionCreditBase * creditRate);

        const finalIncomeTax = Math.max(taxResult.incomeTax - pensionTaxCredit, 0);
        const finalLocalTax = Math.round(finalIncomeTax * CONSTANTS.TAX.LOCAL_TAX_RATE);
        const finalTotalTax = finalIncomeTax + finalLocalTax;
        const effectiveRate = grossIncome > 0 ? finalTotalTax / grossIncome : 0;

        // UI ì—…ë°ì´íŠ¸
        document.getElementById('it-empty').style.display = 'none';
        document.getElementById('it-result').style.display = '';

        document.getElementById('it-total-tax').textContent = APP.format.manwon(finalTotalTax);
        document.getElementById('it-effective').textContent = `ì‹¤íš¨ì„¸ìœ¨ ${APP.format.percent(effectiveRate)}`;
        document.getElementById('it-gross').textContent = APP.format.manwon(grossIncome);
        document.getElementById('it-taxable').textContent = APP.format.manwon(taxableIncome);
        document.getElementById('it-rate').textContent = APP.format.percent(taxResult.appliedRate);
        document.getElementById('it-credits').textContent = APP.format.manwon(pensionTaxCredit);

        // ê³„ì‚° ê³¼ì •
        document.getElementById('it-process').innerHTML = `
          <div class="calc-process-title">ì¢…í•©ì†Œë“ì„¸ ê³„ì‚° ê³¼ì •</div>
          <div class="calc-process-step">
            <span class="step-num">1</span>
            <span>ì´ ì†Œë“ê¸ˆì•¡</span>
            <span class="step-formula">${APP.format.manwon(grossIncome)}</span>
          </div>
          ${salary > 0 ? `<div class="calc-process-step">
            <span class="step-num">2</span>
            <span>ê·¼ë¡œì†Œë“ê³µì œ</span>
            <span class="step-formula">-${APP.format.manwon(earnedDeduction)}</span>
          </div>` : ''}
          ${publicPension > 0 ? `<div class="calc-process-step">
            <span class="step-num">${salary > 0 ? 3 : 2}</span>
            <span>ì—°ê¸ˆì†Œë“ê³µì œ</span>
            <span class="step-formula">-${APP.format.manwon(pensionDeduction)}</span>
          </div>` : ''}
          <div class="calc-process-step">
            <span class="step-num">â†’</span>
            <span>ì¸ì ê³µì œ (${dependents}ëª… Ã— 150ë§Œì›)</span>
            <span class="step-formula">-${APP.format.manwon(personalDeduction)}</span>
          </div>
          ${npPaid > 0 ? `<div class="calc-process-step">
            <span class="step-num">â†’</span>
            <span>êµ­ë¯¼ì—°ê¸ˆ ë³´í—˜ë£Œ ê³µì œ</span>
            <span class="step-formula">-${APP.format.manwon(npDeduction)}</span>
          </div>` : ''}
          <div class="calc-process-step">
            <span class="step-num">â†’</span>
            <span><strong>ê³¼ì„¸í‘œì¤€</strong></span>
            <span class="step-formula"><strong>${APP.format.manwon(taxableIncome)}</strong></span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">â†’</span>
            <span>ì‚°ì¶œì„¸ì•¡ (ì„¸ìœ¨ ${APP.format.percent(taxResult.appliedRate)})</span>
            <span class="step-formula">${APP.format.manwon(taxResult.incomeTax)}</span>
          </div>
          ${pensionTaxCredit > 0 ? `<div class="calc-process-step">
            <span class="step-num">â†’</span>
            <span>ì—°ê¸ˆ ì„¸ì•¡ê³µì œ</span>
            <span class="step-formula">-${APP.format.manwon(pensionTaxCredit)}</span>
          </div>` : ''}
          <div class="calc-process-step">
            <span class="step-num">â†’</span>
            <span>ì†Œë“ì„¸</span>
            <span class="step-formula">${APP.format.manwon(finalIncomeTax)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">â†’</span>
            <span>ì§€ë°©ì†Œë“ì„¸ (10%)</span>
            <span class="step-formula">${APP.format.manwon(finalLocalTax)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">â˜…</span>
            <span><strong>ì´ ì„¸ê¸ˆ</strong></span>
            <span class="step-formula"><strong>${APP.format.manwon(finalTotalTax)}</strong></span>
          </div>
        `;

        // ëˆ„ì§„ì„¸ìœ¨ êµ¬ê°„ ì°¨íŠ¸
        const brackets = CONSTANTS.TAX.INCOME_TAX_BRACKETS;
        const bracketLabels = [];
        const bracketRates = [];
        const bracketAmounts = [];
        let prevLimit = 0;

        for (const b of brackets) {
          const upper = b.limit === Infinity ? prevLimit + 50000000 : b.limit;
          bracketLabels.push(b.limit === Infinity
            ? `${APP.format.number(prevLimit / 10000)}ë§Œ~`
            : `${APP.format.number(prevLimit / 10000)}~${APP.format.number(b.limit / 10000)}ë§Œ`);
          bracketRates.push(b.rate * 100);

          // ì´ êµ¬ê°„ì— í•´ë‹¹í•˜ëŠ” ì„¸ê¸ˆ
          const segmentLower = prevLimit;
          const segmentUpper = Math.min(taxableIncome, b.limit === Infinity ? taxableIncome : b.limit);
          const segmentAmount = segmentUpper > segmentLower
            ? Math.round((segmentUpper - segmentLower) * b.rate)
            : 0;
          bracketAmounts.push(Math.round(segmentAmount / 10000));

          prevLimit = b.limit === Infinity ? prevLimit : b.limit;
          if (taxableIncome <= (b.limit === Infinity ? Infinity : b.limit)) break;
        }

        APP.chart.create('itBracketChart', {
          type: 'bar',
          data: {
            labels: bracketLabels,
            datasets: [
              {
                label: 'êµ¬ê°„ë³„ ì„¸ê¸ˆ (ë§Œì›)',
                data: bracketAmounts,
                backgroundColor: bracketAmounts.map((_, i) =>
                  APP.chart.colors.palette[i % APP.chart.colors.palette.length] + '66'
                ),
                borderColor: bracketAmounts.map((_, i) =>
                  APP.chart.colors.palette[i % APP.chart.colors.palette.length]
                ),
                borderWidth: 2,
              }
            ]
          },
          options: {
            plugins: {
              title: { display: true, text: 'ê³¼ì„¸í‘œì¤€ êµ¬ê°„ë³„ ì„¸ê¸ˆ (ë§Œì›)', font: { size: 16 } }
            },
            scales: {
              y: { title: { display: true, text: 'ë§Œì›' }, beginAtZero: true }
            }
          }
        });

        // ì„¸ìœ¨í‘œ
        const tableBody = CONSTANTS.TAX.INCOME_TAX_BRACKETS.map((b, i) => {
          const prevL = i === 0 ? 0 : CONSTANTS.TAX.INCOME_TAX_BRACKETS[i - 1].limit;
          const isActive = taxableIncome > prevL && (i === 0 || taxableIncome > CONSTANTS.TAX.INCOME_TAX_BRACKETS[i - 1].limit);
          const isCurrent = taxableIncome <= b.limit && taxableIncome > prevL;
          return `<tr${isCurrent ? ' style="background:var(--primary-alpha); font-weight:700;"' : ''}>
            <td>${b.limit === Infinity ? APP.format.number(prevL / 10000) + 'ë§Œì› ì´ˆê³¼' : APP.format.number(prevL / 10000) + ' ~ ' + APP.format.number(b.limit / 10000) + 'ë§Œì›'}</td>
            <td>${(b.rate * 100)}%</td>
            <td>${APP.format.number(b.deduction / 10000)}ë§Œì›</td>
            <td>${isCurrent ? 'â† í•´ë‹¹ êµ¬ê°„' : ''}</td>
          </tr>`;
        }).join('');
        document.querySelector('#it-bracket-table tbody').innerHTML = tableBody;

        APP.storage.saveForm('taxIncomeForm');
      },

      // ==========================================
      // íƒ­2: ì—°ê¸ˆì†Œë“ ì ˆì„¸
      // ==========================================
      calcPensionTax() {
        const form = document.getElementById('taxPensionForm');
        const getVal = (name) => Number(form[name].value.replace(/[^0-9]/g, '')) * 10000;

        const age = Number(form.age.value) || 65;
        const privatePension = getVal('privatePension');
        const publicPension = getVal('publicPension');
        const finIncome = getVal('finIncome');
        const etcIncome = getVal('etcIncome');
        const otherIncome = publicPension + finIncome + etcIncome;

        // ë¶„ë¦¬ê³¼ì„¸ vs ì¢…í•©ê³¼ì„¸ ë¹„êµ
        const comparison = CalcEngine.tax.comparePrivatePensionTax(privatePension, otherIncome, age);

        // ê¸°íƒ€ì†Œë“ ì„¸ê¸ˆ (ê³µì ì—°ê¸ˆ+ê¸ˆìœµ+ê¸°íƒ€ ì¢…í•©ê³¼ì„¸)
        const otherTaxable = Math.max(otherIncome - CalcEngine.tax.calcPensionDeduction(publicPension) - CONSTANTS.TAX.BASIC_DEDUCTION, 0);
        const otherTaxResult = CalcEngine.tax.calcIncomeTax(otherTaxable);

        document.getElementById('pt-empty').style.display = 'none';
        document.getElementById('pt-result').style.display = '';

        // ë¶„ë¦¬ê³¼ì„¸ ì¹´ë“œ
        document.getElementById('pt-sep-rate').textContent = APP.format.percent(comparison.separate.rate);
        document.getElementById('pt-sep-tax').textContent = APP.format.manwon(comparison.separate.totalTax);
        document.getElementById('pt-sep-other-tax').textContent = APP.format.manwon(otherTaxResult.totalTax);
        document.getElementById('pt-sep-total').textContent = APP.format.manwon(comparison.separate.totalTax + otherTaxResult.totalTax);

        // ì¢…í•©ê³¼ì„¸ ì¹´ë“œ
        document.getElementById('pt-comp-income').textContent = APP.format.manwon(comparison.comprehensive.totalIncome);
        document.getElementById('pt-comp-deduction').textContent = '-' + APP.format.manwon(comparison.comprehensive.pensionDeduction);
        document.getElementById('pt-comp-tax').textContent = APP.format.manwon(comparison.comprehensive.tax);
        document.getElementById('pt-comp-total').textContent = APP.format.manwon(comparison.comprehensive.tax);

        // ì¶”ì²œ
        const sepCard = document.getElementById('pt-sep-card');
        const compCard = document.getElementById('pt-comp-card');
        if (comparison.recommended === 'ë¶„ë¦¬ê³¼ì„¸') {
          sepCard.classList.add('recommended');
          compCard.classList.remove('recommended');
        } else {
          compCard.classList.add('recommended');
          sepCard.classList.remove('recommended');
        }

        const limit = CONSTANTS.TAX.PRIVATE_PENSION_SEPARATE_LIMIT;
        document.getElementById('pt-recommend-text').innerHTML =
          `<strong>${comparison.recommended}ì´ ìœ ë¦¬í•©ë‹ˆë‹¤.</strong> ì ˆì„¸ íš¨ê³¼: <strong>${APP.format.manwon(comparison.saving)}</strong><br>` +
          (privatePension <= limit
            ? `ì‚¬ì ì—°ê¸ˆ ${APP.format.manwon(privatePension)}ì€ 1,500ë§Œì› ì´í•˜ì´ë¯€ë¡œ ì €ìœ¨ ë¶„ë¦¬ê³¼ì„¸(${APP.format.percent(comparison.separate.rate)})ê°€ ì ìš©ë©ë‹ˆë‹¤.`
            : `ì‚¬ì ì—°ê¸ˆ ${APP.format.manwon(privatePension)}ì€ 1,500ë§Œì›ì„ ì´ˆê³¼í•˜ë¯€ë¡œ 15% ë¶„ë¦¬ê³¼ì„¸ ë˜ëŠ” ì¢…í•©ê³¼ì„¸ ì¤‘ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);

        // ìµœì  ìˆ˜ë ¹ì•¡ ì°¨íŠ¸: ì‚¬ì ì—°ê¸ˆ ê¸ˆì•¡ë³„ ì„¸ê¸ˆ ë³€í™”
        const chartLabels = [];
        const chartSep = [];
        const chartComp = [];
        for (let amount = 0; amount <= 40000000; amount += 1000000) {
          chartLabels.push(Math.round(amount / 10000) + 'ë§Œ');
          const c = CalcEngine.tax.comparePrivatePensionTax(amount, otherIncome, age);
          chartSep.push(Math.round((c.separate.totalTax) / 10000));
          chartComp.push(Math.round(c.comprehensive.additionalTax / 10000));
        }

        APP.chart.create('ptOptimalChart', {
          type: 'line',
          data: {
            labels: chartLabels,
            datasets: [
              {
                label: 'ë¶„ë¦¬ê³¼ì„¸ ì„¸ê¸ˆ (ë§Œì›)',
                data: chartSep,
                borderColor: APP.chart.colors.primary,
                backgroundColor: APP.chart.colors.primaryAlpha,
                fill: false, tension: 0.3,
              },
              {
                label: 'ì¢…í•©ê³¼ì„¸ ì¶”ê°€ì„¸ê¸ˆ (ë§Œì›)',
                data: chartComp,
                borderColor: APP.chart.colors.danger,
                backgroundColor: APP.chart.colors.dangerAlpha,
                fill: false, tension: 0.3,
                borderDash: [5, 5],
              }
            ]
          },
          options: {
            plugins: {
              title: { display: true, text: 'ì‚¬ì ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ë³„ ì„¸ê¸ˆ ë¹„êµ', font: { size: 16 } },
              annotation: undefined,
            },
            scales: {
              x: { title: { display: true, text: 'ì‚¬ì ì—°ê¸ˆ ì—°ê°„ ìˆ˜ë ¹ì•¡' } },
              y: { title: { display: true, text: 'ì„¸ê¸ˆ (ë§Œì›)' }, beginAtZero: true }
            }
          }
        });

        APP.storage.saveForm('taxPensionForm');
      },

      // ==========================================
      // íƒ­3: í‡´ì§ì†Œë“ì„¸
      // ==========================================
      calcRetireTax() {
        const form = document.getElementById('taxRetireForm');
        const retireIncome = Number(form.retireIncome.value.replace(/[^0-9]/g, '')) * 10000;
        const serviceYears = Number(form.serviceYears.value) || 20;

        const tax = CalcEngine.retirementPension.calcRetirementIncomeTax(retireIncome, serviceYears);
        const netAmount = retireIncome - tax.totalTax;

        document.getElementById('rt-empty').style.display = 'none';
        document.getElementById('rt-result').style.display = '';

        document.getElementById('rt-total-tax').textContent = APP.format.manwon(tax.totalTax);
        document.getElementById('rt-effective').textContent = `ì‹¤íš¨ì„¸ìœ¨ ${APP.format.percent(tax.effectiveRate)}, ê·¼ì† ${serviceYears}ë…„`;
        document.getElementById('rt-gross').textContent = APP.format.manwon(retireIncome);
        document.getElementById('rt-net').textContent = APP.format.manwon(netAmount);
        document.getElementById('rt-income-tax').textContent = APP.format.manwon(tax.incomeTax);
        document.getElementById('rt-local-tax').textContent = APP.format.manwon(tax.localTax);

        // ê³„ì‚° ê³¼ì •
        document.getElementById('rt-process').innerHTML = `
          <div class="calc-process-title">ì—°ë¶„ì—°ìŠ¹ë²• ìƒì„¸ ê³¼ì •</div>
          <div class="calc-process-step">
            <span class="step-num">1</span>
            <span>í‡´ì§ê¸‰ì—¬ì•¡</span>
            <span class="step-formula">${APP.format.manwon(retireIncome)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">2</span>
            <span>ê·¼ì†ì—°ìˆ˜ê³µì œ (${serviceYears}ë…„)</span>
            <span class="step-formula">-${APP.format.manwon(tax.serviceDeduction)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">3</span>
            <span>í‡´ì§ì†Œë“ê³¼ì„¸í‘œì¤€</span>
            <span class="step-formula">${APP.format.manwon(tax.taxBase1)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">4</span>
            <span>í™˜ì‚°ê¸‰ì—¬ = ê³¼ì„¸í‘œì¤€ Ã— 12 Ã· ${serviceYears}</span>
            <span class="step-formula">${APP.format.manwon(tax.convertedIncome)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">5</span>
            <span>í™˜ì‚°ê¸‰ì—¬ê³µì œ</span>
            <span class="step-formula">-${APP.format.manwon(tax.convertedDeduction)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">6</span>
            <span>í™˜ì‚°ê³¼ì„¸í‘œì¤€</span>
            <span class="step-formula">${APP.format.manwon(tax.taxableConverted)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">7</span>
            <span>í™˜ì‚°ì‚°ì¶œì„¸ì•¡ (ì¢…í•©ì†Œë“ì„¸ìœ¨ ì ìš©)</span>
            <span class="step-formula">${APP.format.manwon(tax.convertedTax)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">8</span>
            <span>ì‚°ì¶œì„¸ì•¡ = í™˜ì‚°ì„¸ì•¡ Ã— ${serviceYears} Ã· 12</span>
            <span class="step-formula">${APP.format.manwon(tax.incomeTax)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">9</span>
            <span>ì§€ë°©ì†Œë“ì„¸ (10%)</span>
            <span class="step-formula">${APP.format.manwon(tax.localTax)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">â˜…</span>
            <span><strong>ì´ ë‚©ë¶€ì„¸ì•¡</strong></span>
            <span class="step-formula"><strong>${APP.format.manwon(tax.totalTax)}</strong></span>
          </div>
        `;

        // íŒŒì´ ì°¨íŠ¸
        APP.chart.create('rtPieChart', {
          type: 'doughnut',
          data: {
            labels: ['ì„¸í›„ ìˆ˜ë ¹ì•¡', 'í‡´ì§ì†Œë“ì„¸', 'ì§€ë°©ì†Œë“ì„¸'],
            datasets: [{
              data: [netAmount, tax.incomeTax, tax.localTax],
              backgroundColor: [APP.chart.colors.secondary, APP.chart.colors.danger, APP.chart.colors.accent],
              borderWidth: 2,
            }]
          },
          options: {
            plugins: {
              title: { display: true, text: 'í‡´ì§ê¸ˆ ì„¸ê¸ˆ êµ¬ì„±', font: { size: 16 } }
            }
          }
        });

        // ì—°ê¸ˆì „í™˜ ì ˆì„¸ íš¨ê³¼
        const pensionCompare = CalcEngine.retirementPension.compareLumpSumVsPension(retireIncome, serviceYears, 10, 0.03, 55);
        document.getElementById('rt-lump-tax').textContent = APP.format.manwon(pensionCompare.lumpSum.tax);
        document.getElementById('rt-pension-tax').textContent = APP.format.manwon(pensionCompare.pension.totalTax);
        document.getElementById('rt-saving').textContent = pensionCompare.taxSaving > 0
          ? APP.format.manwon(pensionCompare.taxSaving)
          : APP.format.manwon(Math.abs(pensionCompare.taxSaving));

        APP.storage.saveForm('taxRetireForm');
      },

      calcRetireCompare() {
        const form = document.getElementById('taxRetireForm');
        const retireIncome = Number(form.retireIncome.value.replace(/[^0-9]/g, '')) * 10000;

        if (retireIncome <= 0) {
          alert('í‡´ì§ê¸ˆì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        document.getElementById('rt-compare').style.display = '';

        const labels = [];
        const taxes = [];
        const rates = [];
        const netAmounts = [];

        for (let y = 5; y <= 35; y += 5) {
          labels.push(y + 'ë…„');
          const t = CalcEngine.retirementPension.calcRetirementIncomeTax(retireIncome, y);
          taxes.push(Math.round(t.totalTax / 10000));
          rates.push(Number((t.effectiveRate * 100).toFixed(2)));
          netAmounts.push(Math.round((retireIncome - t.totalTax) / 10000));
        }

        APP.chart.create('rtCompareChart', {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'ì„¸ê¸ˆ (ë§Œì›)',
                data: taxes,
                backgroundColor: APP.chart.colors.dangerAlpha,
                borderColor: APP.chart.colors.danger,
                borderWidth: 2,
                yAxisID: 'y',
              },
              {
                label: 'ì‹¤íš¨ì„¸ìœ¨ (%)',
                data: rates,
                type: 'line',
                borderColor: APP.chart.colors.primary,
                backgroundColor: APP.chart.colors.primaryAlpha,
                tension: 0.3,
                yAxisID: 'y1',
              }
            ]
          },
          options: {
            plugins: {
              title: { display: true, text: `í‡´ì§ê¸ˆ ${APP.format.manwon(retireIncome)} ê¸°ì¤€ ê·¼ì†ì—°ìˆ˜ë³„ ì„¸ê¸ˆ`, font: { size: 16 } }
            },
            scales: {
              y: {
                type: 'linear', position: 'left',
                title: { display: true, text: 'ì„¸ê¸ˆ (ë§Œì›)' },
                beginAtZero: true,
              },
              y1: {
                type: 'linear', position: 'right',
                title: { display: true, text: 'ì‹¤íš¨ì„¸ìœ¨ (%)' },
                beginAtZero: true,
                grid: { drawOnChartArea: false },
              }
            }
          }
        });

        document.getElementById('rt-compare-text').innerHTML =
          `<strong>ê·¼ì†ì—°ìˆ˜ê°€ ê¸¸ìˆ˜ë¡ ì„¸ê¸ˆì´ ì¤„ì–´ë“­ë‹ˆë‹¤.</strong><br>` +
          `ê°™ì€ í‡´ì§ê¸ˆ ${APP.format.manwon(retireIncome)} ê¸°ì¤€ìœ¼ë¡œ:<br>` +
          `â€¢ ê·¼ì† 5ë…„: ì„¸ê¸ˆ ${APP.format.manwon(taxes[0] * 10000)} (ì‹¤íš¨ ${rates[0]}%)<br>` +
          `â€¢ ê·¼ì† 20ë…„: ì„¸ê¸ˆ ${APP.format.manwon(taxes[3] * 10000)} (ì‹¤íš¨ ${rates[3]}%)<br>` +
          `â€¢ ê·¼ì† 35ë…„: ì„¸ê¸ˆ ${APP.format.manwon(taxes[taxes.length - 1] * 10000)} (ì‹¤íš¨ ${rates[rates.length - 1]}%)<br>` +
          `ì—°ë¶„ì—°ìŠ¹ë²•ì—ì„œ ê·¼ì†ì—°ìˆ˜ê°€ ê³µì œì™€ ì„¸ìœ¨ ë¶„í• ì— ëª¨ë‘ ì˜í–¥ì„ ì¤ë‹ˆë‹¤.`;
      },
    };

    document.addEventListener('DOMContentLoaded', () => {
      APP.storage.restoreForm('taxIncomeForm');
      APP.storage.restoreForm('taxPensionForm');
      APP.storage.restoreForm('taxRetireForm');
    });
  </script>
</body>
</html>
