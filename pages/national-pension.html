<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-M92225DERV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-M92225DERV');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>êµ­ë¯¼ì—°ê¸ˆ ê³„ì‚°ê¸° - ì—°ê¸ˆ í¬í„¸</title>
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/calculator.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
</head>
<body>
  <nav id="main-nav"></nav>

  <div class="container">
    <div class="page-header fade-in">
      <h1 class="page-title">êµ­ë¯¼ì—°ê¸ˆ ê³„ì‚°ê¸°</h1>
      <p class="page-subtitle">ì˜ˆìƒ ìˆ˜ë ¹ì•¡, ì¡°ê¸°/ì—°ê¸° ìˆ˜ë ¹ ë¹„êµ, ì¶”ë‚© íš¨ê³¼ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
    </div>

    <div class="info-box info fade-in">
      <span class="icon">ğŸ’¡</span>
      <div>
        <strong>êµ­ë¯¼ì—°ê¸ˆ ê¸°ë³¸ ì‚°ì‹</strong><br>
        ê¸°ë³¸ì—°ê¸ˆì•¡ = ì†Œë“ëŒ€ì²´ìœ¨(43%) Ã— (Aê°’ + Bê°’) Ã— ê°€ì…ê¸°ê°„ ê³„ìˆ˜<br>
        Aê°’: ì „ì²´ ê°€ì…ì í‰ê· ì†Œë“(ì•½ 309ë§Œì›), Bê°’: ë³¸ì¸ í‰ê· ì†Œë“
      </div>
    </div>

    <div class="calc-layout fade-in">
      <!-- ì¢Œì¸¡: ì…ë ¥ -->
      <div class="calc-input-panel">
        <div class="card">
          <h2 class="card-title"><span class="card-icon">ğŸ“</span>ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>
          <form id="npForm">
            <div class="input-section">
              <div class="form-group">
                <label class="form-label">ì¶œìƒì—°ë„</label>
                <input type="number" class="form-input" name="birthYear" placeholder="ì˜ˆ: 1965" min="1940" max="2000" value="1965">
              </div>
              <div class="form-group">
                <label class="form-label">ì›” í‰ê·  ê¸°ì¤€ì†Œë“ì›”ì•¡ <span class="unit">(ë§Œì›)</span>
                  <span class="tooltip-trigger" data-tooltip="êµ­ë¯¼ì—°ê¸ˆ ê°€ì…ê¸°ê°„ ë™ì•ˆì˜ í‰ê·  ê¸°ì¤€ì†Œë“ì›”ì•¡ì…ë‹ˆë‹¤. ì—°ê¸ˆê³µë‹¨ ì˜ˆìƒì—°ê¸ˆ ì¡°íšŒì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.">?</span>
                </label>
                <div class="input-group">
                  <input type="text" class="form-input" name="avgIncome" data-type="money" placeholder="300" value="350">
                  <span class="input-suffix">ë§Œì›</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ì´ ê°€ì…ê¸°ê°„ <span class="unit">(ë…„)</span></label>
                <div class="input-group">
                  <input type="number" class="form-input" name="enrollYears" min="0" max="40" value="25">
                  <span class="input-suffix">ë…„</span>
                </div>
              </div>
            </div>

            <div class="input-section">
              <div class="input-section-title">ì¡°ê¸°/ì—°ê¸° ìˆ˜ë ¹ ì„¤ì •</div>
              <div class="form-group">
                <label class="form-label">ì¡°ê¸°ìˆ˜ë ¹ ì—°ìˆ˜ <span class="unit">(ìµœëŒ€ 5ë…„)</span></label>
                <div class="form-range-container">
                  <input type="range" class="form-range" name="earlyYears" min="0" max="5" value="0" oninput="document.getElementById('earlyVal').textContent=this.value+'ë…„'">
                  <span class="range-value" id="earlyVal">0ë…„</span>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ì—°ê¸°ìˆ˜ë ¹ ì—°ìˆ˜ <span class="unit">(ìµœëŒ€ 5ë…„)</span></label>
                <div class="form-range-container">
                  <input type="range" class="form-range" name="deferYears" min="0" max="5" value="0" oninput="document.getElementById('deferVal').textContent=this.value+'ë…„'">
                  <span class="range-value" id="deferVal">0ë…„</span>
                </div>
              </div>
            </div>

            <div class="input-section">
              <div class="input-section-title">ì¶”ë‚© ë¶„ì„ (ì„ íƒ)</div>
              <div class="form-group">
                <label class="form-label">ì¶”ë‚© ê¸°ê°„ <span class="unit">(ê°œì›”)</span>
                  <span class="tooltip-trigger" data-tooltip="êµ­ë¯¼ì—°ê¸ˆ ì¶”ë‚©ì€ 2020.12 ê°œì •ë²•ì— ë”°ë¼ ìµœëŒ€ 10ë…„ ë¯¸ë§Œ(119ê°œì›”)ê¹Œì§€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.">?</span>
                </label>
                <div class="input-group">
                  <input type="number" class="form-input" name="additionalMonths" min="0" max="119" value="0">
                  <span class="input-suffix">ê°œì›”</span>
                </div>
                <p class="form-help">ìµœëŒ€ 119ê°œì›”(10ë…„ ë¯¸ë§Œ) ê°€ëŠ¥</p>
              </div>
            </div>

            <button type="button" class="btn btn-primary btn-block btn-lg" onclick="NationalPension.calculate()">
              ê³„ì‚°í•˜ê¸°
            </button>
          </form>
        </div>
      </div>

      <!-- ìš°ì¸¡: ê²°ê³¼ -->
      <div class="calc-result-panel">
        <div id="np-empty" class="card">
          <div class="empty-result">
            <div class="icon">ğŸ›ï¸</div>
            <div class="text">ì¢Œì¸¡ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
            <div class="sub-text">ì˜ˆìƒ êµ­ë¯¼ì—°ê¸ˆ ìˆ˜ë ¹ì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤</div>
          </div>
        </div>

        <div id="np-result" style="display:none;">
          <!-- ê¸°ë³¸ ê²°ê³¼ ë°°ë„ˆ -->
          <div class="result-banner fade-in">
            <div class="label">ì˜ˆìƒ ì›” ìˆ˜ë ¹ì•¡ (ì •ìƒ ìˆ˜ë ¹)</div>
            <div class="amount" id="np-monthly">-</div>
            <div class="sub" id="np-start-info">-</div>
          </div>

          <!-- ë¯¸ë‹ˆ ì¹´ë“œ ìš”ì•½ -->
          <div class="result-mini-grid fade-in">
            <div class="result-mini">
              <div class="label">ìˆ˜ë ¹ ê°œì‹œ ì—°ë ¹</div>
              <div class="value" id="np-start-age">-</div>
            </div>
            <div class="result-mini">
              <div class="label">ì¡°ê¸°ìˆ˜ë ¹ ì‹œ</div>
              <div class="value orange" id="np-early">-</div>
            </div>
            <div class="result-mini">
              <div class="label">ì—°ê¸°ìˆ˜ë ¹ ì‹œ</div>
              <div class="value green" id="np-deferred">-</div>
            </div>
            <div class="result-mini">
              <div class="label">ì†Œë“ëŒ€ì²´ìœ¨</div>
              <div class="value" id="np-replacement">-</div>
            </div>
          </div>

          <!-- ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ -->
          <div class="card fade-in">
            <h2 class="card-title"><span class="card-icon">ğŸ“Š</span>ì¡°ê¸°/ì •ìƒ/ì—°ê¸° ëˆ„ì  ìˆ˜ë ¹ì•¡ ë¹„êµ</h2>
            <div class="scenario-cards" id="np-scenarios">
              <div class="scenario-card" id="sc-early">
                <div class="scenario-label" style="color:var(--accent);">ì¡°ê¸°ìˆ˜ë ¹</div>
                <div class="scenario-value" id="sc-early-val">-</div>
                <div class="scenario-desc" id="sc-early-desc">-</div>
              </div>
              <div class="scenario-card" id="sc-normal">
                <div class="scenario-label" style="color:var(--primary);">ì •ìƒìˆ˜ë ¹</div>
                <div class="scenario-value" id="sc-normal-val">-</div>
                <div class="scenario-desc" id="sc-normal-desc">-</div>
              </div>
              <div class="scenario-card" id="sc-deferred">
                <div class="scenario-label" style="color:var(--secondary);">ì—°ê¸°ìˆ˜ë ¹</div>
                <div class="scenario-value" id="sc-deferred-val">-</div>
                <div class="scenario-desc" id="sc-deferred-desc">-</div>
              </div>
            </div>
            <div class="chart-container tall">
              <canvas id="npCompareChart"></canvas>
            </div>
            <div class="info-box warning" id="np-breakeven-info" style="display:none;">
              <span class="icon">âš–ï¸</span>
              <div id="np-breakeven-text"></div>
            </div>
          </div>

          <!-- ì¶”ë‚© ë¶„ì„ -->
          <div class="card fade-in" id="np-addpay-card" style="display:none;">
            <h2 class="card-title"><span class="card-icon">ğŸ’°</span>ì¶”ë‚© íš¨ê³¼ ë¶„ì„</h2>
            <div class="result-mini-grid">
              <div class="result-mini">
                <div class="label">ì¶”ë‚© ë¹„ìš©</div>
                <div class="value red" id="np-addpay-cost">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì›” ì—°ê¸ˆ ì¦ê°€ì•¡</div>
                <div class="value green" id="np-addpay-increase">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì¶”ë‚© í›„ ì—°ê¸ˆ</div>
                <div class="value" id="np-addpay-new">-</div>
              </div>
              <div class="result-mini">
                <div class="label">ì†ìµë¶„ê¸°</div>
                <div class="value orange" id="np-addpay-breakeven">-</div>
              </div>
            </div>
            <div class="info-box success">
              <span class="icon">âœ…</span>
              <div id="np-addpay-summary"></div>
            </div>
          </div>

          <!-- ê³„ì‚° ê³¼ì • -->
          <div class="card fade-in">
            <h2 class="card-title"><span class="card-icon">ğŸ”</span>ê³„ì‚° ê³¼ì •</h2>
            <div class="calc-process" id="np-process"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer id="footer"></footer>

  <script src="../js/constants.js"></script>
  <script src="../js/calculator-engine.js"></script>
  <script src="../js/common.js"></script>
  <script>
    const NationalPension = {
      calculate() {
        const form = document.getElementById('npForm');
        const birthYear = Number(form.birthYear.value) || 1965;
        const avgIncome = Number(form.avgIncome.value.replace(/[^0-9]/g, '')) * 10000;
        const enrollYears = Number(form.enrollYears.value) || 0;
        const earlyYears = Number(form.earlyYears.value) || 0;
        const deferYears = Number(form.deferYears.value) || 0;
        const additionalMonths = Number(form.additionalMonths.value) || 0;

        if (enrollYears < 10) {
          alert('êµ­ë¯¼ì—°ê¸ˆ ìˆ˜ê¸‰ ìê²©ì€ ìµœì†Œ 10ë…„ ì´ìƒ ê°€ì…ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          return;
        }

        const startAge = CalcEngine.nationalPension.getStartAge(birthYear);
        const basicPension = CalcEngine.nationalPension.calcBasicPension(avgIncome, enrollYears * 12);
        const earlyPension = CalcEngine.nationalPension.calcEarlyPension(basicPension, earlyYears);
        const deferredPension = CalcEngine.nationalPension.calcDeferredPension(basicPension, deferYears);
        const replacementRate = avgIncome > 0 ? basicPension / avgIncome : 0;

        // UI í‘œì‹œ
        document.getElementById('np-empty').style.display = 'none';
        document.getElementById('np-result').style.display = '';

        document.getElementById('np-monthly').textContent = APP.format.manwon(basicPension);
        document.getElementById('np-start-info').textContent = `${birthYear}ë…„ìƒ ê¸°ì¤€, ${startAge}ì„¸ë¶€í„° ìˆ˜ë ¹ ì‹œì‘`;
        document.getElementById('np-start-age').textContent = startAge + 'ì„¸';
        document.getElementById('np-early').textContent = earlyYears > 0 ? APP.format.manwon(earlyPension) : '-';
        document.getElementById('np-deferred').textContent = deferYears > 0 ? APP.format.manwon(deferredPension) : '-';
        document.getElementById('np-replacement').textContent = APP.format.percent(replacementRate);

        // ì‹œë‚˜ë¦¬ì˜¤ ë¹„êµ
        const endAge = 90;
        const scenarios = CalcEngine.nationalPension.compareScenarios(basicPension, startAge, earlyYears || 3, deferYears || 3, endAge);

        // ì‹œë‚˜ë¦¬ì˜¤ ì¹´ë“œ
        const earlyTotal = scenarios.early[scenarios.early.length - 1];
        const normalTotal = scenarios.normal[scenarios.normal.length - 1];
        const deferredTotal = scenarios.deferred[scenarios.deferred.length - 1];

        const maxTotal = Math.max(earlyTotal, normalTotal, deferredTotal);
        document.getElementById('sc-early').className = 'scenario-card' + (earlyTotal === maxTotal ? ' best' : '');
        document.getElementById('sc-normal').className = 'scenario-card' + (normalTotal === maxTotal ? ' best' : '');
        document.getElementById('sc-deferred').className = 'scenario-card' + (deferredTotal === maxTotal ? ' best' : '');

        const eY = earlyYears || 3;
        const dY = deferYears || 3;
        document.getElementById('sc-early-val').textContent = APP.format.manwon(earlyTotal);
        document.getElementById('sc-early-desc').textContent = `${startAge - eY}ì„¸~${endAge}ì„¸, ì›” ${APP.format.manwon(CalcEngine.nationalPension.calcEarlyPension(basicPension, eY))}`;
        document.getElementById('sc-normal-val').textContent = APP.format.manwon(normalTotal);
        document.getElementById('sc-normal-desc').textContent = `${startAge}ì„¸~${endAge}ì„¸, ì›” ${APP.format.manwon(basicPension)}`;
        document.getElementById('sc-deferred-val').textContent = APP.format.manwon(deferredTotal);
        document.getElementById('sc-deferred-desc').textContent = `${startAge + dY}ì„¸~${endAge}ì„¸, ì›” ${APP.format.manwon(CalcEngine.nationalPension.calcDeferredPension(basicPension, dY))}`;

        // ì†ìµë¶„ê¸°ì  ì°¾ê¸°
        let breakevenAge = null;
        for (let i = 0; i < scenarios.ages.length; i++) {
          if (scenarios.deferred[i] > scenarios.normal[i] && !breakevenAge) {
            breakevenAge = scenarios.ages[i];
          }
        }
        const beInfo = document.getElementById('np-breakeven-info');
        if (breakevenAge) {
          beInfo.style.display = '';
          document.getElementById('np-breakeven-text').innerHTML =
            `<strong>ì†ìµë¶„ê¸°ì  ë¶„ì„:</strong> ì—°ê¸°ìˆ˜ë ¹ì´ ì •ìƒìˆ˜ë ¹ ëˆ„ì ì•¡ì„ ì¶”ì›”í•˜ëŠ” ì‹œì ì€ <strong>${breakevenAge}ì„¸</strong>ì…ë‹ˆë‹¤. ` +
            `${breakevenAge}ì„¸ ì´ìƒ ìƒì¡´ ì‹œ ì—°ê¸°ìˆ˜ë ¹ì´ ìœ ë¦¬í•©ë‹ˆë‹¤.`;
        } else {
          beInfo.style.display = 'none';
        }

        // ì°¨íŠ¸
        APP.chart.create('npCompareChart', {
          type: 'line',
          data: {
            labels: scenarios.ages.map(a => a + 'ì„¸'),
            datasets: [
              {
                label: `ì¡°ê¸°ìˆ˜ë ¹ (${startAge - eY}ì„¸~)`,
                data: scenarios.early.map(v => Math.round(v / 10000)),
                borderColor: APP.chart.colors.accent,
                backgroundColor: APP.chart.colors.accentAlpha,
                fill: false, tension: 0.3,
              },
              {
                label: `ì •ìƒìˆ˜ë ¹ (${startAge}ì„¸~)`,
                data: scenarios.normal.map(v => Math.round(v / 10000)),
                borderColor: APP.chart.colors.primary,
                backgroundColor: APP.chart.colors.primaryAlpha,
                fill: false, tension: 0.3, borderWidth: 3,
              },
              {
                label: `ì—°ê¸°ìˆ˜ë ¹ (${startAge + dY}ì„¸~)`,
                data: scenarios.deferred.map(v => Math.round(v / 10000)),
                borderColor: APP.chart.colors.secondary,
                backgroundColor: APP.chart.colors.secondaryAlpha,
                fill: false, tension: 0.3,
              },
            ]
          },
          options: {
            plugins: {
              title: { display: true, text: 'ëˆ„ì  ìˆ˜ë ¹ì•¡ ë¹„êµ (ë§Œì›)', font: { size: 16 } }
            },
            scales: { y: { title: { display: true, text: 'ë§Œì›' } } }
          }
        });

        // ì¶”ë‚© ë¶„ì„
        if (additionalMonths > 0) {
          const addPay = CalcEngine.nationalPension.calcAdditionalPayment(basicPension, additionalMonths, avgIncome);
          document.getElementById('np-addpay-card').style.display = '';
          document.getElementById('np-addpay-cost').textContent = APP.format.manwon(addPay.cost);
          document.getElementById('np-addpay-increase').textContent = '+' + APP.format.manwon(addPay.increase);
          document.getElementById('np-addpay-new').textContent = APP.format.manwon(addPay.newPension);
          const beMonths = addPay.breakEvenMonths;
          document.getElementById('np-addpay-breakeven').textContent = beMonths < Infinity
            ? Math.ceil(beMonths / 12) + 'ë…„ ' + (beMonths % 12) + 'ê°œì›”'
            : 'í•´ë‹¹ì—†ìŒ';
          
          let summaryText = `ì¶”ë‚© ë¹„ìš© <strong>${APP.format.manwon(addPay.cost)}</strong>ì„ ë‚©ë¶€í•˜ë©´ ì›” ì—°ê¸ˆì´ ` +
            `<strong>${APP.format.manwon(addPay.increase)}</strong> ì¦ê°€í•©ë‹ˆë‹¤. `;
          
          if (additionalMonths > 119) {
            summaryText += `<br><span style="color:var(--danger); font-size:var(--font-sm);">* ë²•ì  ìµœëŒ€ ì¶”ë‚© ê¸°ê°„ì¸ 119ê°œì›”ë§Œ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.</span>`;
          }
          
          document.getElementById('np-addpay-summary').innerHTML = summaryText;
        } else {
          document.getElementById('np-addpay-card').style.display = 'none';
        }

        // ê³„ì‚° ê³¼ì •
        const A = CONSTANTS.NATIONAL_PENSION.A_VALUE;
        const B = Math.min(avgIncome, CONSTANTS.NATIONAL_PENSION.INCOME_UPPER);
        const rate = CONSTANTS.NATIONAL_PENSION.REPLACEMENT_RATE_2025;
        let factor = enrollYears <= 20 ? enrollYears / 20 : 1 + 0.05 * (enrollYears - 20);

        document.getElementById('np-process').innerHTML = `
          <div class="calc-process-title">êµ­ë¯¼ì—°ê¸ˆ ê¸°ë³¸ì—°ê¸ˆì•¡ ì‚°ì¶œ ê³¼ì •</div>
          <div class="calc-process-step">
            <span class="step-num">1</span>
            <span>Aê°’ (ì „ì²´ ê°€ì…ì í‰ê· ì†Œë“ì›”ì•¡)</span>
            <span class="step-formula">${APP.format.won(A)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">2</span>
            <span>Bê°’ (ë³¸ì¸ í‰ê·  ê¸°ì¤€ì†Œë“ì›”ì•¡)</span>
            <span class="step-formula">${APP.format.won(B)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">3</span>
            <span>ì†Œë“ëŒ€ì²´ìœ¨</span>
            <span class="step-formula">${(rate * 100).toFixed(1)}%</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">4</span>
            <span>ê°€ì…ê¸°ê°„ ê³„ìˆ˜ (${enrollYears}ë…„)</span>
            <span class="step-formula">${factor.toFixed(4)}</span>
          </div>
          <div class="calc-process-step">
            <span class="step-num">5</span>
            <span>ê¸°ë³¸ì—°ê¸ˆì•¡ = ${(rate * 100).toFixed(1)}% Ã— (${APP.format.won(A)} + ${APP.format.won(B)}) Ã— ${factor.toFixed(2)}</span>
            <span class="step-formula">${APP.format.won(basicPension)}/ì›”</span>
          </div>
          ${earlyYears > 0 ? `
          <div class="calc-process-step">
            <span class="step-num">6</span>
            <span>ì¡°ê¸°ìˆ˜ë ¹ ê°ì•¡ (ì—° 6% Ã— ${earlyYears}ë…„ = ${earlyYears * 6}% ê°ì•¡)</span>
            <span class="step-formula">${APP.format.won(earlyPension)}/ì›”</span>
          </div>` : ''}
          ${deferYears > 0 ? `
          <div class="calc-process-step">
            <span class="step-num">${earlyYears > 0 ? 7 : 6}</span>
            <span>ì—°ê¸°ìˆ˜ë ¹ ì¦ì•¡ (ì—° 7.2% Ã— ${deferYears}ë…„ = ${(deferYears * 7.2).toFixed(1)}% ì¦ì•¡)</span>
            <span class="step-formula">${APP.format.won(deferredPension)}/ì›”</span>
          </div>` : ''}
        `;

        // ì €ì¥
        APP.storage.saveForm('npForm');
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      APP.storage.restoreForm('npForm');
    });
  </script>
</body>
</html>
